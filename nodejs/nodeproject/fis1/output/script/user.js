define(function(e,t,i){var r=e("jquery");e("http://www.100bt.com/doudou/plugin/isWeak"),e("http://www.100bt.com/doudou/plugin/md5"),e("style/user.css");var n=e("script/WindowLock.js");window.userInfo=null;var o=function(e,t){var i="",r=function(i,r,n){var s=o(i);n&&!!n.md5&&!!e.hex_md5&&(s[n.md5]=hex_md5(s[n.md5]));try{t.get(i.action,s,r)}catch(a){}},o=function(e){var i={},r=t(e).serializeArray();return t.each(r,function(){void 0!==i[this.name]?(i[this.name].push||(i[this.name]=[t.trim(i[this.name])]),i[this.name].push(t.trim(this.value)||"")):i[this.name]=t.trim(this.value)||""}),i},a=function(){this.init()};a.prototype.init=function(){this._clear()},a.prototype._clear=function(){this._tasks=[],this._pointer=-1},a.prototype.add=function(e){var t=this;return t._tasks.push(e),t},a.prototype.start=function(){return this._tasks!=[]&&(this._pointer=0,this._tasks[this._pointer]()),this},a.prototype.resolve=function(){-1!=this._pointer&&(this._pointer<this._tasks.length-1?(this._pointer++,this._tasks[this._pointer]()):this._pointer==this._tasks.length-1&&this._doneFun.apply(this,arguments))},a.prototype.reject=function(){this._pointer=-1,this._failFun.apply(this,arguments)},a.prototype.done=function(e){return this._doneFun=e,this},a.prototype.fail=function(e){return this._failFun=e,this};var c=function(){var i=function(){var e=this,t='<div id="accountBox"> <div class="acTitle"> <div class="acTitleContent">登录</div> </div> <div id="acLoginForm" class="acForm loginForm"> <form action="/uc/login.jsonp?callback=?"method="post"> <div class="acItem icon icon_name"> <input id="login_mail" name="email" type="email" placeholder="登录邮箱" required="required" maxlength="50"> </div><div class="acItem icon icon_password"> <input id="login_password" name="MD5Password" type="password" placeholder="密码" required="required" maxlength="30"> </div> <div class="acFooter"> <a id="turnRegister_btn" class="btn al" href="###">注 册</a> <button id="login_btn" class="btn ar" href="###" autofocus="true">登 录</button> </div> </form> </div> <div id="acRegisterForm" class="acForm registerForm"> <form action="/uc/register.jsonp?callback=?" method="post"> <div class="acItem icon icon_name"> <input id="register_name" name="nickName" type="text"placeholder="设置3到5个字符的昵称" required="required" maxlength="5"> </div> <div class="acItem icon icon_mail section"> <input id="register_mail" name="email" type="email"placeholder="登录邮箱" required="required" maxlength="50"> </div> <div class="acItem icon icon_password"> <input id="register_password" name="MD5Password" type="password"placeholder="请输入6到16位字符的密码" required="required" maxlength="16"> </div> <div class="acItem icon icon_password section"> <input id="register_passwordConfirm" type="password"placeholder="再次输入登录密码" required="required" maxlength="16"> </div> <div class="acItem acVerificationItem"> <input id="register_verification" name="imgCode" type="text"placeholder="请输入验证码" required="required" maxlength="10"> <img id="register_verification_img" src="" alt=""> </div> <div class="acFooter"> <a id="turnLogin_btn" class="btn al" href="###">登 录</a> <button id="register_btn" class="btn ar" href="###" autofocus="true">完成注册</button> </div> </form> </div> </div>';e.outerWrapper=new n({content:t,ontouched:function(){e.remove()},slidable:!0})},o=function(){return function(){m.get(0).src="/uc/RegisterIdentifyImgCode.html?v="+new Date/1,g.val("")}}(),c=function(){l.css({position:"relative",top:(f-l.height())/2+"px"})};i.call(this);{var d=function(){return t("form input").on("input",function(){this.setCustomValidity(""),this.checkValidity()}),function(e,i,r){i.setCustomValidity(r),t(e).find("button").trigger("click"),o()}}(),u=this,l=t("#accountBox"),m=t("#register_verification_img"),g=t("#register_verification"),f=t(e).height();t(e).width()}c(),l.find("#login_mail").val(u._getUsername()),o(),t("#register_verification_img").on("click",function(){o()});var h="login";t("#turnRegister_btn").on("click",function(){return l.find(".loginForm").hide(),l.find(".registerForm").show(),o(),l.find(".acTitleContent").text("注册"),c(),h="register",!1}),t("#turnLogin_btn").on("click",function(){return l.find(".registerForm").hide(),l.find(".loginForm").show(),l.find(".acTitleContent").text("登录"),c(),h="login",!1}),t("#accountBox input").on("invalid",function(e){var t=this,i={valueMissing:"请填写此字段。",defaultError:"格式有误。",tooLong:"太长了。"};for(key in i)if(e.target.validity[key])return void t.setCustomValidity(i[key]);e.target.validity.customError||t.setCustomValidity(i.defaultError)}),t("#acLoginForm form").on("submit",function(){var i=t(this);return r(i.get(0),function(r){r.res.code<0?d(i[0],t("#login_password")[0],"用户名或密码输入有误。"):0==r.res.code&&(e.userInfo=r,u.remove(),s.loginCb.fire("success",r.data))},{md5:"MD5Password"}),!1}),t("#acRegisterForm form").on("submit",function(){var i=t(this),n=new a;try{n.add(function(){var e=t.trim(t("#register_name").val());e.length<3||e.length>5?n.reject({formTarget:i[0],inputTarget:t("#register_name")[0],error:"请输入3到5个字符的昵称"}):n.resolve()}).add(function(){var e=t.trim(t("#register_mail").val());return e.length<1||e.length>50?void n.reject({formTarget:i[0],inputTarget:t("#register_mail")[0],error:"邮箱地址格式不正确"}):void t.ajax({url:"/uc/checkEmail.json?email="+encodeURIComponent(e),type:"get",async:!0,success:function(e){e.res.code<0?n.reject({formTarget:i[0],inputTarget:t("#register_mail")[0],error:e.res.detail}):0==e.res.code&&n.resolve()}})}).add(function(){var e=t.trim(t("#register_password").val());e.length<6||e.length>16?n.reject({formTarget:i[0],inputTarget:t("#register_password")[0],error:"密码需为6到16位字符"}):n.resolve()}).add(function(){var e=t.trim(t("#register_password").val()),r=t.trim(t("#register_passwordConfirm").val());e!=r?n.reject({formTarget:i[0],inputTarget:t("#register_passwordConfirm")[0],error:"两次输入的密码不一致"}):n.resolve()}).add(function(){In("isweak",function(){var e=new WeakPasswordChecker,r=e.isWeak(t.trim(t("#register_password").val()));r?n.reject({formTarget:i[0],inputTarget:t("#register_password")[0],error:"这个密码太简单容易被盗号哦，换一个吧~~"}):n.resolve()})}).add(function(){r(i.get(0),function(r){r.res.code<0?n.reject({formTarget:i[0],inputTarget:t("#register_verification")[0],error:r.res.detail}):0==r.res.code&&(e.userInfo=r,u.remove(),s.loginCb.fire("success",r.data),n.resolve())},{md5:"MD5Password"})}).done(function(){}).fail(function(e){d(e.formTarget,e.inputTarget,e.error)}).start()}catch(o){}return!1})};return function(e){this._setUsername=function(e){i=e},this._getUsername=function(){return i},c.call(this,e),this.$wrap=t("#accountBox")}}(window,r);o.prototype={remove:function(){this._setUsername(this.$wrap.find("#login_mail").val()),this.outerWrapper.remove()}};var s={showLogin:function(){new o},loginCb:r.Callbacks({memory:!0,unique:!0}),checkLogin:function(){var e=this;return r.get("/util/getMyUserInfo.jsonp",function(t){if(console.log(t),t&&t.res){var i=t.res;0==i.code?e.loginCb.fire("success",t.data):e.loginCb.fire("fail",t)}},"json").fail(function(t){var i=new Date;i.setDate(i.getDate()-1),document.cookie="dduid=0;path=/;expires="+i.toGMTString()+"/",e.loginCb.fire("fail",t)}),this}};s.afterCheckLogin=function(e,t){if(e||t){var i=this;this.loginCb.add(function(r,n){"success"==r&&e?e(n):t&&t(n),i.loginCb.remove(arguments.callee)})}},window.UC=s,i.exports=s});