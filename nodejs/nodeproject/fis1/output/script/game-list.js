define(function(t,i,e){function n(){this.init.apply(this,arguments)}var a=t("jquery"),s=t("script/util.js");t("http://resource.a0bi.com/qq/script/jquery-EnterScreen"),t("style/game-list.css");var o={root:"#gameList",item:"li",cnt:".list",more:".loading",tmp:'<li class="animate2" animate data-link="http://www.doudou.in/game/${id}/">				<img class="icon" src="${icon}" />				<span class="name">${title}</span>				<i class="tip tip${tip}">${tipTitle}</i>				#desc			</li>',desc:'<span class="desc">${categoryName}</span>',needDesc:!0,pager:".pager",totalCount:-1},r={pn:0,limit:15,isTest:!1,categoryId:0,gameType:0},d="http://www.doudou.in/games.jsonp?callback=?";n.prototype={init:function(t,i){return this.cnf=a.extend({},o,t||{}),this.dfParam=a.extend({},r,i||{}),t=this.cnf,t.tmp=t.tmp.replace("#desc",t.needDesc?t.desc:""),this.$root=a(t.root),this.$list=this.$root.find(t.cnt),this.$more=this.$root.find(t.more),this.$pager=this.$root.find(t.pager),this.loadedList=[],this.ajax={},this.bindUI()},bindUI:function(){var t=this,i=this.cnf;return this.$root.on("click",i.more,function(){return t.initDataFromLoadedList(),!1}),this.$root.on("click",i.item,s.delay(function(){var t=a(this).data("link");return t?void s.openWindow(t):!1})),this.reset(),this},setLoading:function(){this.$more.text("游戏加载中..")},setLoaded:function(){},reset:function(t){return a.extend(this.dfParam,t||{}),this.dfParam.pn=0,this.cnf.totalCount=-1,this.$list.empty(),this.initPager(),this},initPager:function(){var t=this.cnf,i=this.dfParam,e=this,n=0;this.pageLoader=window.EnterScreen({selector:this.$more,fixTop:20,callback:function(){e.data().done(function(i){e.initDataFromLoadedList(),i&&i.games.length<=0?e.$more.addClass("hide"):(n+=i.games.length,console.log("总数:"+n),n<t.totalCount?setTimeout(function(){e.pageLoader.restart()},1e3):e.$more.addClass("hide"))}),i.pn++}})},data:function(t){var i=this.cnf,e=this;this.ajax.abort&&this.ajax.abort(),this.loadedList=[],e.setLoading();var n=a.extend({},this.dfParam,t);return this.ajax=a.getJSON(d,n,function(t){console.log(t),e.loadedList=s.value(t,"games")||[],i.totalCount<=0&&(i.totalCount=t.totalCount)}).always(function(t){e.setLoaded(),(!t||t.totalCount<=0)&&e.$more.text("暂时没有数据哦~")}),this.ajax},initDataFromLoadedList:function(){if(!(this.cnf.totalCount<=0)){var t=this.loadedList;t.length>0&&this.appendList(t),this.loadedList.length<=0}},appendList:function(t){for(var i,e=this.cnf.tmp,n=0,o=t.length;o>n;n++){var r=t[n];r.tip=r.tip||0,r.tipTitle=["","新","热","荐"][r.tip],r=s.format(e,r,"&nbsp;"),i=a(r),this.$list.append(i),function(t,i){setTimeout(function(){i.removeAttr("animate")},80*t)}(n,i)}}},e.exports=n});