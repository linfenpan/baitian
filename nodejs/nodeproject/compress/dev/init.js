var GVars={PRIZEMAP:{1:{name:"晶钻碎片×188"},2:{name:"晶钻碎片×564"},3:{name:"晶钻碎片×940"},4:{name:"魅情酒吧背景"},5:{name:"樱桃魔力胸针"},6:{name:"魔力珍稀材料暖光×10"},7:{name:"魔力珍稀材料蜜露×10"},8:{name:"魔力珍稀材料马卡龙×10"}},actTopic:"http://qq.100bt.com/topic-11915087-1.html",shareWord:"分享语：过新年啦，#奥比岛#魔力天裁师安琪儿有超多新年愿望想樱桃帮忙实现哦！来帮助樱桃完成安琪儿的愿望，就有机会获得晶钻、魔力时装单件或魔力时装材料等超多奖励！马上去看看>",shareTitle:"奥比岛2015魔力天裁师_ 安琪儿的新年愿望",gameRoot:"http://aobi.100bt.com/",shareLink:"http://aobi.100bt.com/gwActivity/20150206/",shareImg:"http://aobi.100bt.com/gwActivity/20150206/dist/style/img_s/share.jpg",shareItems:["qqweibo","sinaweibo","qq","qzone"],favlink:"http://aobi.100bt.com/",favName:"百田奥比岛"},Service={canLocalClipboard:function(){var e=!1;try{window.clipboardData.setData("text",""),e=!0}catch(t){}finally{return e}},doTask:function(e,t){var o=$.Deferred();return $.getJSON("http://service.100bt.com/gwchoujiang/addChouJianCount.jsonp?businessId=aobi_20150213&callback=?",{taskIndex:e,str:t},function(e){o.resolve({detail:e.res.resultCode.detail,code:e.res.resultCode.code,result:e.res.value})}),o},choujiang:function(e){var t=$.Deferred();return $.getJSON("http://service.100bt.com/gwchoujiang/chouJian.jsonp?businessId=aobi_20150213&callback=?",{taskIndex:e},function(e){t.resolve({detail:e.res.resultCode.detail,code:e.res.resultCode.code,result:e.res.value})}),t},queryActUserNumb:function(){var e=$.Deferred();return $.getJSON("http://service.100bt.com/gwchoujiang/queryNewRewardUsers.jsonp?businessId=aobi_20150213&callback=?",function(t){e.resolve({code:t.res.resultCode.code,detail:t.res.resultCode.detail,userNumb:t.totalUserNum})}),e},queryActData:function(){var e=$.Deferred();return $.getJSON("http://service.100bt.com/gwchoujiang/queryUser.jsonp?businessId=aobi_20150213&callback=?",function(t){t.res.value;e.resolve({packages:t.res.value.cjButtonClickKey,code:t.res.resultCode.code,detail:t.res.resultCode.detail,leaveCjCount:t.res.value.leaveCjCount,prize:t.res.value.jpCodes})}),e},showLogin:function(){In("ui_popuplogin",function(){ui_popuplogin.init(),showLogin({dontneedCheck:!0})})},getShareHTML:function(e){var t=$.Deferred();return modulizer.use(["shareRenderer"],function(){var o=e||GVars,n=o.shareWord,a=o.shareLink,i=o.shareImg,s=o.shareItems,c=o.shareTitle,r={config:s,data:{title:c,description:n,url:a,imageSrc:i,summary:n}};o.template&&(r.template=o.template),t.resolve(shareBtnRenderer.getHtmlByOption(r))}),t},initPlayer:function(e,t){var o=$(e).data("src");modulizer.use(["flowplayer"],function(){e.flowplayer("http://aola.100bt.com/js/util/flowplayer-3.2.7.swf",$.extend(!0,{clip:{url:o,autoPlay:!0,autoBuffering:!0,onFinish:function(){this.play()}}},t))})},initSwfPlayer:function(e){var t=$(e).data("src");$(e).html('<object id="mymovie" type="application/x-shockwave-flash" data="'+t+'" class="sigeFlashClass"><param name="wmode" value="transparent"><param name="movie" value="'+t+'"><param name="quality" value="high"><param name="menu" value="false"><param name="allowScriptAccess" value="always"><param name="flashvars" value=""></object>')},updateUserData:function(e,t){var o={init:function(e){GVars.actUserInfo=e}},n=o[t];n&&n(e)},updateUserDataUI:function(){$chanceNumb=$(".actDesc .chance",$("#act1")),Service.queryActData().done(function(e){$chanceNumb.text(e.leaveCjCount),modulizer.use(["packageView"],function(t){t.render(e)})})}},packageCfg={clipboard:{path:"http://www.100bt.com/resource/js/plugins/zclip/jquery.zclip.min.js"},replyInterFace:{path:"http://qq.100bt.com/gwActivity/20130905/script/replyInterFace.js"},crossRequest:{path:"http://my.100bt.com/chat/js/crossRequest.js"},"npop-dev":{path:"http://www.100bt.com/resource/js/plugins/npopnew/npop/npop-dev.js?20140919"},shareRenderer:{rely:["npop-dev"],registerNS:"window.shareBtnRenderer",path:"http://resource.a0bi.com/resource/js/plugins/sharerenderer.js"},flowplayer:{path:"http://www.100bt.com/media/flowplayer/flowplayer-3.2.12.min.js"}};modulizer.configModuleMap(packageCfg),modulizer.define(["npop-dev"],"sidebar",function(){function e(){function e(){$(window).scrollTop()<50?o.addClass("sb-fistScreen"):o.removeClass("sb-fistScreen")}function n(){var e=$(".sb");e.removeClass("sb-heightRes sb-lowRes"),e.addClass($(window).width()>t?"sb-heightRes":"sb-lowRes")}$(window).bind("resize.sidebar",zUtil.fntools.debounce(n,500)).resize(),$(window).bind("scroll.sidebar",zUtil.fntools.debounce(e,500)).scroll(),$(".a6").closest(".sbItem").on("mouseenter",function(){$(this).find(".sb-drop").show()}).on("mouseleave",function(){$(this).find(".sb-drop").hide()}),$(".sbItem").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),Service.getShareHTML().done(function(e){$(".sb-wshare").html(e)})}var t=1399,o=$(".sb");return{init:e}}),modulizer.define(["npop-dev","actPops"],"act0",function(e,t){t.init();var o=this;Service.getShareHTML().done(function(e){$(".wshareBtns",o.root).html(e)}),this.root.on("click",".videoBtn",function(){Service.pagePops.show_mvPop()}),Service.queryActUserNumb().done(function(e){e.code>=0?$(".actStateBar .numb",o.root).text(e.userNumb):Util.debug("actStateBar init fail:",e.detail)})}),modulizer.define(["npop-dev"],"packageView",function(){function e(e){var o=$("#act1 .wnyPackages"),n=$("#act1 .actDesc .chance");n.text(e.leaveCjCount);var a=[!1,!1,!1,!1,!1];e.packages&&(a=e.packages);var i=$.map(a,function(e,o){return Util.template(t,{index:o,pos:o+1,disableClass:e?"nyPackage_disabled nyPackage_disabled"+(o+1):""})}).join("");o.html(i)}var t='<a href="###" class="nyPackage nyPackage${pos} ${disableClass}" data-index="${index}"></a>';return{render:e}}),modulizer.define(["npop-dev","allActPops","packageView"],"act1",function(e,t,o){{var n=$(".wnyPackages",this.root);$(".actDesc .chance",this.root)}n.on("click",".nyPackage:not('.nyPackage_disabled')",function(){if(!GVars.userInfo)return Service.showLogin(),!1;var e=$(this).data("index");Service.choujiang(e).done(function(e){e.code>=0?(t.prize(e.result.CodeType,e.result.Code),Service.updateUserDataUI()):-101==e.code||-103==e.code?(t.noprize(),Service.updateUserDataUI()):-7==e.code?Service.showLogin():-102==e.code?t.pkgopenZero():t.com({content:e.detail})})}).on("click",".nyPackage_disabled",function(){}),this.root.on("click",".wbtn1 .btn1",function(){t.prizeiswhat()}),this.root.on("click",".wbtn1 .btn2",function(){t.myPrize()}),Service.queryActData().done(function(e){o.render(e)}),Util.debug("act1")}),modulizer.define(["npop-dev","allActPops"],"act2",function(e,t){$("#wechatForm").on("submit",function(){var e=$(this).find(".strTXT").val();return $.trim(e)?(Service.doTask(1,e).done(function(e){e.code>=0?(t.wishcomplete1(),Service.updateUserDataUI()):-7==e.code?Service.showLogin():t.com({content:e.detail}),$("#wechatForm")[0].reset()}),!1):(t.com({content:"请输入答案"}),!1)})}),modulizer.define(["npop-dev","allActPops"],"act3",function(e,t){var o=this;Service.getShareHTML($.extend({},GVars,{template:"%{shareLink}",shareItems:["qzone"]})).done(function(e){$(".act3ShareBtn",o.root).attr("href",e).click(function(){return window.open($(this).attr("href"),"newwindow","height=600, width=800, top=200, left=300, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no"),Service.doTask(2).done(function(e){e.code>=0?setTimeout(function(){t.wishcomplete1(),Service.updateUserDataUI()},5e3):-7==e.code?Service.showLogin():t.com(-4==e.code?{content:"今天已经完成过啦，看看其他愿望吧！明天记得再来哦！"}:{content:e.detail})}),!1})})}),modulizer.define(["npop-dev","crossRequest","replyInterFace","allActPops"],"act4",function(e,t,o,n){var a=11915087;ReplyInterFace.prototype.alert=function(e){n.com({content:e})};var i;i=i||new ReplyInterFace(a,!0),$("#wishForm").on("submit",function(){if(!GVars.userInfo)return Service.showLogin(),!1;var e=$(this).find(".wishForm_duoduoId").val(),t=$(this).find(".wishForm_word").val();if(!$.trim(e))return n.com({content:"hey~别偷懒,把内容都填了吧~"}),!1;if($.trim(t).length<20)return n.com({content:"祝福应该要20字以上~"}),!1;if($.trim(t).length>200)return n.com({content:"请输入言简意赅的祝福,200字以内就够了哟~"}),!1;var o="<p>多多号:"+e+"</p><p>2015奥比岛愿望:"+t+"</p>";return i.submit(o,function(){Service.doTask(3).done(function(e){e.code>=0?(n.wishcomplete2(),Service.updateUserDataUI()):n.com({content:"发表成功！"}),$("#wishForm")[0].reset()})},{dealWithLogin:!1}),!1})}),modulizer.define(["part3","sidebar","actPops","part2"],"main",function(e,t,o,n){t.init(),o.init(),n.init(),ajaxLogin.listen("userInfoReady",function(e){GVars.userInfo=e.userInfo,Service.updateUserDataUI()}),ajaxLogin.runCommonLoginCheck()}),modulizer.define("part2",function(){function e(){var e="安琪儿";$.getJSON("http://service.100bt.com/PubTimeNow.action?callback=?",function(t){var o=t.date;e+="2015-02-16">=o?"最喜欢":"2015-02-19">=o?"最爱吃":"2015-02-24">=o?"最可爱":"的愿望"}).done(function(){$("#act2 .mainwidth").append("<span class='aqeTxt'>"+e+"</span>")})}return{init:e}}),modulizer.define(["npop-dev","clipboard"],"actPops",function(){function e(){this.domElement.on("click",".gohongbaoBtn",function(){$(window).scrollTop($("#act1").offset().top)}).on("click",".pop_addFavBtn",function(){Util.AddFavorite(GVars.favlink,GVars.favName)})}function t(){if(this.hasInit)return!1;this.hasInit=!0,zUtil.generateNS("Page.PopDefinition",{commonActPop:{content:'<div class="innerbg"><div class="info"></div></div>',className:"commonActPop",popHandler:{init:function(){var t=this;e.call(this),this.tips=Page.Widget.TipsFactory.getTips({alignTarget:this.domElement,timeout:1e3,alignMyPlace:"center middle",alignTargetPlace:"center middle"}),t.domElement.on("click",".close",function(){if(!Service.canLocalClipboard()){var e=t.domElement.find(".cpLink");e.length>0&&e.each(function(e,t){$(t).zclip("remove")})}})},beforeshow:function(){var e=Service.popPool.commonActPop.runtimeData;$(".info",this.domElement).html(e.content),$(".title",this.domElement).html(e.title)},aftershow:function(){var e=$(this.domElement).find(".cpLink"),t=this;e.length>0&&(Service.canLocalClipboard()?e.click(function(){t.tips.show({content:"复制成功，可Ctrl+V粘贴到别处~"}),window.clipboardData.setData("text",$(this).closest(".prizeItem").find(".pCode").val())}):e.each(function(e,o){$(o).zclip({path:"http://www.100bt.com/resource/js/plugins/zclip/ZeroClipboard.swf",copy:function(){return t.tips.show({content:"复制成功，可Ctrl+V粘贴到别处~"}),$(o).closest(".prizeItem").find(".pCode").val()},afterCopy:function(){}})}))}}},giftPop:{posMethod:"absolute",content:'<div class="innerbg"><div class="info"></div></div>',className:"giftPop",popHandler:{init:function(){e.call(this)},beforeshow:function(){var e=Service.popPool.giftPop.runtimeData;$(".info",this.domElement).html(e.content),$(".title",this.domElement).html(e.title)}}},commonSPActPop:{content:'<div class="innerbg"><div class="info"></div></div>',className:"commonSPActPop",popHandler:{init:function(){e.call(this)},beforeshow:function(){var e=Service.popPool.commonSPActPop.runtimeData;$(".info",this.domElement).html(e.content),$(".title",this.domElement).html(e.title)}}},mvPop:{content:'<div class="innerbg"><div class="info"></div></div>',className:"mvPop",popHandler:{init:function(){var e=this;this.domElement.find(".close").click(function(){e.domElement.find("object").remove()}).text("×")},beforeshow:function(){Service.popPool.mvPop.runtimeData;this.domElement.find(".info").append('<a data-src="dist/resource/mv.swf" class="mvLink"></a>'),Service.initSwfPlayer($(".mvLink",this.domElement))}}}});var t="Service.pagePops",o="Page.PopDefinition",n="Service.popPool";zUtil.npopWrappInit(t,o,n,{overlayColor:"#000",overlayOpacity:"0.7"})}return{init:t,hasInit:!1}}),modulizer.define(["npop","actPops"],"allActPops",function(e,t){function o(e){var t='<a href="${link}" target="${target}" class="popBtn ${cssClass}"><span class="popBtnTxt">${word}</span><span class="popBtnr"></span></a>';return'<div class="popCtrls">'+$.map(e,function(e){return Util.template(t,{cssClass:e.cssClass?e.cssClass:"",word:e.word?e.word:"什么按钮？",link:e.link?e.link:"###",target:e.link?"_blank":"_self"})}).join("")+"</div>"}function n(e){var t='<div class="popTitle">${title}</div>';return Util.template(t,{title:e})}function a(e){var t='<table class="popContentTable"><tbody><tr><td>${content}</td></tr></tbody></table>';return Util.template(t,{content:e})}function i(){Service.queryActData().done(function(e){var t,i,c='<div class="prizeItem clearfix"><span class="pName l" title="${name}">${name}</span><input class="pCode l" type="text" value="${code}"/><span class="pCtrlCp pr tC l"><a href="###" class="cpLink fontStylelargeSp">复制</a></span></div>';if(!GVars.userInfo)return Service.showLogin(),!1;if(e.code>=0||-9==e.code){if(e.prize&&e.prize.length>0){var r=e.prize;t='<div class="myPrizeScroll fontStylelarge">'+$.map(r,function(e){return Util.template(c,{name:GVars.PRIZEMAP[e.CodeType].name,code:e.Code})}).join("")+"</div>",t+='<p>奖励兑换码，均可在<a href="http://aobi.100bt.com/" class="sp" target="_blank">奥比岛官网</a>登录游戏，到【浪漫花海】找NPC樱小桃兑换！</p>',i=o([{word:"兑换奖励",cssClass:"myPrize_1 closeBtn",link:"http://aobi.100bt.com/"},{word:"继续开红包",cssClass:"myPrize_2 closeBtn gohongbaoBtn"}])}else t='<p class="fontStylelarge">还没获得任何奖励呢，马上完成安琪儿的愿望，去开红包吧！</p>',i=o([{word:"去完成愿望",cssClass:"myPrize_3 closeBtn"},{word:"开红包",cssClass:"myPrize_4 closeBtn gohongbaoBtn"}]);Service.pagePops.show_commonActPop({content:n("我的奖励")+a(t)+i})}else-7==e.code?Service.showLogin():s(e.detail)})}function s(e){var t=e||{},i=t.title||"温馨提示",s=t.content||"";Service.pagePops.show_commonActPop({content:n(i)+a('<p class="fontStylelarge">'+s+"</p>")+o([{word:"确定",cssClass:"com_1 closeBtn"}])})}function c(){Service.pagePops.show_commonActPop({content:n("戳痛我啦！%>_<%")+a('<p class="fontStylelarge tL">开红包次数是0哦，马上去完成安琪儿的愿望就能获得开红包次数！如果今天已经完成所有愿望，明天记得再来吧！</p>')+o([{word:"继续完成愿望",cssClass:"myPrize_1 closeBtn"},{word:"收藏页面明天再来",cssClass:"myPrize_2 closeBtn pop_addFavBtn"}])})}function r(e,t){var i='<div class="prizeItem clearfix"><span class="pName l" title="${name}">${name}</span><input class="pCode l" type="text" value="${code}"/><span class="pCtrlCp pr tC l"><a href="###" class="cpLink fontStylelargeSp">复制</a></span></div>',s='<div class="myPrizeScroll fontStylelarge">'+Util.template(i,{name:GVars.PRIZEMAP[e].name,code:t})+"</div>";s=a(s),Service.pagePops.show_commonActPop({content:n("恭喜获得奖励")+s+o([{word:"兑换奖励",cssClass:"myPrize_1 closeBtn",link:"http://aobi.100bt.com/"},{word:"继续开红包",cssClass:"myPrize_2 closeBtn gohongbaoBtn"}])})}function l(){var e=["我最喜欢希爸爸和小耶妈妈，只是有时候淘气想跟他们玩玩嘛！","每天都能吃到甜点和蛋糕，是我感到最美好的事情，所以我爱抢樱桃东西吃！","每天都开开心心萌萌哒，你有什么想对我说的，可以在奥比岛微信留言哦！","为大家设计更多更美的魔力时装，是我2015最大的愿望，你也赞同吧？！"],t=e[zUtil.randomIntInRange(0,e.length-1)];Service.pagePops.show_commonSPActPop({content:a('<p class="fontStylelarge">这个红包里放的是我的秘密！一般人不造！<br />悄悄告诉你：'+t+"</p>")+o([{word:"继续开红包",cssClass:"noprize_1 closeBtn gohongbaoBtn"}])})}function p(){Service.pagePops.show_commonActPop({content:n("愿望完成")+a('<p class="fontStylelarge">谢谢小奥比，奖励你1次开红包机会！</p>')+o([{word:"继续完成愿望",cssClass:"wishcomplete1_1 closeBtn"},{word:"开红包",cssClass:"wishcomplete1_2 closeBtn gohongbaoBtn"}])})}function d(){Service.pagePops.show_commonActPop({content:n("愿望完成")+a('<p class="fontStylelarge">愿望写得不错嘛，每天首次发表成功，将奖励1次开红包机会！<span class="fontStylelargeSp">（每天都有1次哦）</span></p>')+o([{word:"去看看大家的愿望",cssClass:"wishcomplete2_1 closeBtn",link:GVars.actTopic},{word:"开红包",cssClass:"wishcomplete2_2 closeBtn gohongbaoBtn"}])})}function u(){Service.pagePops.show_giftPop({content:n("红包里有什么")+o([{word:"去完成愿望",cssClass:"prizeiswhat1 closeBtn"},{word:"开红包",cssClass:"prizeiswhat2 closeBtn gohongbaoBtn"}])})}return t.init(),{myPrize:i,pkgopenZero:c,prize:r,noprize:l,wishcomplete1:p,wishcomplete2:d,prizeiswhat:u,com:s}}),modulizer.compileDOM($(".staticModule")),modulizer.use(["main"]);