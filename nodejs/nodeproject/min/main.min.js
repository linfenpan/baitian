function compressAll(e){console.log("************** 编译中 **************");var i=fs.readdirSync(dirPath);for(var s in i){var r=i[s],a=path.join(dirPath,r),t=path.dirname(a),o=path.extname(a).toLowerCase();fs.lstatSync(a).isFile()&&!/\.min/.test(r)&&(e&&o===e?cp.auto(t,r):(".js"===o||".css"===o)&&cp.auto(t,r))}}var fs=require("fs"),path=require("path"),dirPath=process.cwd(),infix=".min",param=process.argv.slice(2);!function(){var e={};for(var i in param){var s=param[i];0==s.indexOf("-")?e[s.replace(/-/g,"")]=!0:e.fileName=s}param=e}(process,param);var Compressor=function(){this.uglify=require("uglify-js"),this.yui=require("yuicompressor")};Compressor.prototype={css:function(e,i){if(this.exists(e,i)){var s=path.join(e,i),r=this;r.yui.compress(s,{charset:"utf8",type:"js"},function(a,t){var o="suc";a?o="err":(s=r.newPath(e,i,".css"),fs.writeFileSync(s,t)),r[o](s,"css")})}},js:function(e,i){if(this.exists(e,i)){var s=path.join(e,i),r=this,a=this.uglify.minify(s,{mangle:{except:["require","module","exports"],toplevel:!1}});s=this.newPath(e,i,".js"),fs.writeFileSync(s,a.code),r.suc(s,".js")}},err:function(e){console.log("Error:"+e)},suc:function(e){console.log("Sucess:"+e)},exists:function(e,i){var s=path.join(e,i);return fs.existsSync(s)?!0:(this.err(s),!1)},newPath:function(e,i,s){var r=path.basename(i,s);return path.join(e,r+infix+s)},auto:function(e,i){var s=path.extname(i).toLowerCase(),r="js";".css"==s&&(r="css"),this[r](e,i)}};var cp=new Compressor,operationMap={j:".js",c:".css"},isDealWith=!1;for(var i in param){var item=operationMap[i];if(item&&"fileName"!==item){param.fileName?cp[item.slice(1)](dirPath,param.fileName):compressAll(item),isDealWith=!0;break}}isDealWith||(param.fileName?cp.auto(dirPath,param.fileName):compressAll());