/*! 测试安装grunt 2015-03-03 */
window.onerror=function(){},seajs.config({alias:{_jquery:"http://resource.a0bi.com/resource/js/lib/zepto.min.all",_in:"http://resource.a0bi.com/resource/js/nav/in-min",util:"http://resource.a0bi.com/doudou/v2/script/util.js",user:"http://resource.a0bi.com/doudou/v2/script/user.js",ddWeixin:"http://resource.a0bi.com/doudou/plugin/ddWeixin.min.js",user_for_weixin:"http://resource.a0bi.com/doudou/v2/script/user_for_weixin.js"}}),define("jquery",["_jquery"],function(require,exports,module){module.exports=window.Zepto});var ddReadyEvent="baseAuthorToolIsReady";seajs.use("ddWeixin",function(a){a.autoOpenId("wxf91bab01569cc168",{appType:1,isDebug:!1}).done(function(a){console.log("授权成功"),a?seajs.use("user_for_weixin",function(){seajs.use("nav"),seajs.emit(window.ddReadyEvent)}):(seajs.use("nav"),seajs.emit(window.ddReadyEvent))}).fail(function(){alert("微信公众号信息获取失败..")})}),define("common",function(require,exports,module){var a={},b=require("jquery");module.exports=a,a.isTouchEnv=/mobile/i.test(navigator.userAgent)&&("createTouch"in document||"ontouchstart"in window),a.addClickEvent=a.isTouchEnv?function(){var a=arguments,c=a[0],d=a[1],e=a[2];"function"==b.type(d)&&(d=null,e=a[1]),c.on("touchstart",d,function(){return b(this).attr("active",!0),!1}).on("touchend",d,function(a){var c=this,d=b(this);setTimeout(function(){d.attr("active")&&(d.removeAttr("active"),e.call(c,a))},200)})}:function(){var a=arguments,c=a[0],d=a[1],e=a[2];"function"==b.type(d)&&(d=null,e=a[1]),c.on("click",d,function(a){var c=this,d=b(this);d.attr("active")||(d.attr("active",!0),setTimeout(function(){d.removeAttr("active"),e.call(c,a)},200))})},a.removeClickEvent=function(){var a=arguments,b=a[0],c=a[1];b.off("touchstart",c).off("touchend",c).off("click",c)},a.scrollTo=function(a,b){var c=window.scrollY,d=a,e=new Date,f=b||120,g=setInterval(function(){var a=new Date,b=a-e;if(b>=f||!f)return clearInterval(g),void window.scrollTo(0,d);var h=c+(d-c)*b/f;window.scrollTo(0,h)},4)},a.navigatorType={WX:"weixin",APP:"doudou",PC:"pc",WAP:"mobile"},a.navigator=function(b,c){var d=a.navigatorType;return/mobile|Mobile/g.test(c.userAgent)?/MicroMessenger/i.test(c.userAgent)?d.WX:b.DDInnerJS?d.APP:d.WAP:b.DDInnerJS?d.APP:d.PC}(window,navigator),a.origin=location.protocol+"//"+location.host}),define("nav",function(require,exports,module){function a(a,b){if(k[a]=e.extend({},k[a],b),b&&b.css){var c=b.css;switch(e.type(c)){case"string":k._css[c]=1;break;case"array":for(var d=0,f=c.length;f>d;d++)k._css[c[d]]=1}delete k[a].css}}function b(){var a=k._css,b=document.head||document.getElementsByTagName("head")[0];k._css={};var d=document.createElement("link");d.rel="stylesheet";for(var f in a){var g=d.cloneNode();g.href=f,b.appendChild(g)}var h=i,j=e(h.root);j.html('<div id="headerLeft"></div><div id="headerCenter">标题</div><div id="headerRight"></div>');var l=j.find(h.rootLeft),m=j.find(h.rootRight),n=j.find(h.rootCenter);c(l,h.left),c(m,h.right),c(n,h.center)}function c(a,b){a.empty();for(var c=0,d=b.length;d>c;c++){var f,g=b[c].split("#");if(f=g.length>1?k[g[0]]:k[b[c]]){var h;if(f.param&&g.length>1)for(var l=g.slice(1),c=0,d=f.param.length;d>c;c++){var m=(f.param[c],l[c]);h=f.html.replace(/\${[^}]*}/g,function(){return m||""})}else h=f.html;var n=e(h).appendTo(a);f.click&&(j?!function(a,b){a.on("touchstart",function(){var a=e(this);return a.attr(i.active.split("#")[0],!0),!0}).on("touchend",function(a){var c=i.active.split("#"),d=e(this);if(d.attr(c[0]))return setTimeout(function(){d.removeAttr(c[0]),b.click.call(this,a)},+c[1]),!1})}(n,f):!function(a,b){a.on("click",function(a){return b.click.call(this,a),!1})}(n,f))}}}function d(a){i=e.extend(i,a||{})}var e=require("jquery"),f=require("common"),g=require("util"),h=require("user");console.log(h,"Yonghu");var i=e.extend({root:"#header",active:"active#200",rootLeft:"#headerLeft",rootRight:"#headerRight",rootCenter:"#headerCenter",left:["home","return"],center:[],right:["make","user","refresh"]},window.NavCF||{}),j=/mobile/i.test(navigator.userAgent)&&("createTouch"in document||"ontouchstart"in window),k={_css:{}};a("home",{html:'<a href="http://www.doudou.in/" class="navHome">豆豆游戏</a>',click:function(){return window.isIndex?!1:void(window.top.location="/")}}),a("return",{html:'<a href="javascript:;" class="navBtn navReturn">返回</a>',click:function(){return window.DDInnerJS?DDInnerJS.goback():history.go(-1),!1}}),a("refresh",{html:'<a href="javascript:;" class="navBtn navRefresh">刷新</a>',click:function(){location.reload()}}),a("title",{html:'<a href="javascript:;" class="navBtn navTitle">${name}</a>',param:["name"],click:function(){location.reload()}}),a("make",{html:'<a href="javascript:;" class="navBtn navMake">制作游戏</a>',click:function(){return g.openWindow("/tougao/templateList.html"),!1}}),a("user",{html:'<a href="javascript:;" class="navBtn navUser">个人中心</a>',click:function(){return h.afterCheckLogin(function(){g.openWindow("/uc/usercenter.html")},function(){f.navigator==f.navigatorType.WX?alert("未能正确获取用户信息"):h.showLogin()}),!1}}),b(),module.exports={add:a,init:b,reset:d}}),seajs.use(["common","jquery"],function(a,b){b(window).resize(function(){var a=b("html"),c=a.width();c>720&&(c=720);var d=12*c/320;a.css("font-size",d)}).resize();var c="";c=a.navigator==a.navigatorType.WX?"http://mp.weixin.qq.com/s?__biz=MzA5Nzk2OTIxNw==&mid=201099443&idx=1&sn=00a1d77cf1458023761bc403ec59b1d5#rd":"/play/weixin.html ";var d='<div class="fWrp"><div class="copyright">© doudou.in</div><div class="linkwp"><a href="/play/cooperate.html" class="link">联系我们</a><a href="'+c+'"  class="link">关注我们</a>'+(a.navigator==a.navigatorType.APP?"":'<a href="http://www.doudou.in/play/download.html"  class="link">客户端<em class="hot"></em></a>')+"</div></div>";b("#footer").append(d)}),seajs.on(ddReadyEvent,function(){seajs.use(["user"],function(a){a.checkLogin()}),seajs.use(["common","util"],function(a,b){var c=a.navigator;c==a.navigatorType.PC||c==a.navigatorType.WAP?b.css(".navUser{display:none;}"):c==a.navigatorType.APP&&b.css(".navUser,.navMake{display:none;}"),a.navigator!=a.navigatorType.APP&&seajs.use(["http://resource.a0bi.com/doudou/v2/script/DDdownload.js"],function(){})})}),window.DDInnerJS&&window.DDInnerJS.initPage&&window.DDInnerJS.initPage(1),define(function(require,exports,module){function a(){this.init.apply(this,arguments)}var b=require("jquery"),c=require("./util");require("http://resource.a0bi.com/qq/script/jquery-EnterScreen"),require("../style/game-list.css");var d={root:"#gameList",item:"li",cnt:".list",more:".loading",tmp:'<li class="animate2" animate data-link="http://www.doudou.in/game/${id}/">				<img class="icon" src="${icon}" />				<span class="name">${title}</span>				<i class="tip tip${tip}">${tipTitle}</i>				#desc			</li>',desc:'<span class="desc">${categoryName}</span>',needDesc:!0,pager:".pager",totalCount:-1},e={pn:0,limit:15,isTest:!1,categoryId:0,gameType:0},f="http://www.doudou.in/games.jsonp?callback=?";a.prototype={init:function(a,c){return this.cnf=b.extend({},d,a||{}),this.dfParam=b.extend({},e,c||{}),a=this.cnf,a.tmp=a.tmp.replace("#desc",a.needDesc?a.desc:""),this.$root=b(a.root),this.$list=this.$root.find(a.cnt),this.$more=this.$root.find(a.more),this.$pager=this.$root.find(a.pager),this.loadedList=[],this.ajax={},this.bindUI()},bindUI:function(){var a=this,d=this.cnf;return this.$root.on("click",d.more,function(){return a.initDataFromLoadedList(),!1}),this.$root.on("click",d.item,c.delay(function(){var a=b(this).data("link");return a?void c.openWindow(a):!1})),this.reset(),this},setLoading:function(){this.$more.text("游戏加载中..")},setLoaded:function(){},reset:function(a){return b.extend(this.dfParam,a||{}),this.dfParam.pn=0,this.cnf.totalCount=-1,this.$list.empty(),this.initPager(),this},initPager:function(){var a=this.cnf,b=this.dfParam,c=this,d=0;this.pageLoader=window.EnterScreen({selector:this.$more,fixTop:20,callback:function(){c.data().done(function(b){c.initDataFromLoadedList(),b&&b.games.length<=0?c.$more.addClass("hide"):(d+=b.games.length,console.log("总数:"+d),d<a.totalCount?setTimeout(function(){c.pageLoader.restart()},1e3):c.$more.addClass("hide"))}),b.pn++}})},data:function(a){var d=this.cnf,e=this;this.ajax.abort&&this.ajax.abort(),this.loadedList=[],e.setLoading();var g=b.extend({},this.dfParam,a);return this.ajax=b.getJSON(f,g,function(a){console.log(a),e.loadedList=c.value(a,"games")||[],d.totalCount<=0&&(d.totalCount=a.totalCount)}).always(function(a){e.setLoaded(),(!a||a.totalCount<=0)&&e.$more.text("暂时没有数据哦~")}),this.ajax},initDataFromLoadedList:function(){if(!(this.cnf.totalCount<=0)){var a=this.loadedList;a.length>0&&this.appendList(a),this.loadedList.length<=0}},appendList:function(a){for(var d,e=this.cnf.tmp,f=0,g=a.length;g>f;f++){var h=a[f];h.tip=h.tip||0,h.tipTitle=["","新","热","荐"][h.tip],h=c.format(e,h,"&nbsp;"),d=b(h),this.$list.append(d),function(a,b){setTimeout(function(){b.removeAttr("animate")},80*a)}(f,d)}}},module.exports=a});