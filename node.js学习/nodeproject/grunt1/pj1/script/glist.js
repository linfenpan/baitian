/*! 测试安装grunt 2015-03-03 */
define(function(require,exports,module){function a(){this.init.apply(this,arguments)}var b=require("jquery"),c=require("./util");require("http://resource.a0bi.com/qq/script/jquery-EnterScreen"),require("../style/game-list.css");var d={root:"#gameList",item:"li",cnt:".list",more:".loading",tmp:'<li class="animate2" animate data-link="http://www.doudou.in/game/${id}/">				<img class="icon" src="${icon}" />				<span class="name">${title}</span>				<i class="tip tip${tip}">${tipTitle}</i>				#desc			</li>',desc:'<span class="desc">${categoryName}</span>',needDesc:!0,pager:".pager",totalCount:-1},e={pn:0,limit:15,isTest:!1,categoryId:0,gameType:0},f="http://www.doudou.in/games.jsonp?callback=?";a.prototype={init:function(a,c){return this.cnf=b.extend({},d,a||{}),this.dfParam=b.extend({},e,c||{}),a=this.cnf,a.tmp=a.tmp.replace("#desc",a.needDesc?a.desc:""),this.$root=b(a.root),this.$list=this.$root.find(a.cnt),this.$more=this.$root.find(a.more),this.$pager=this.$root.find(a.pager),this.loadedList=[],this.ajax={},this.bindUI()},bindUI:function(){var a=this,d=this.cnf;return this.$root.on("click",d.more,function(){return a.initDataFromLoadedList(),!1}),this.$root.on("click",d.item,c.delay(function(){var a=b(this).data("link");return a?void c.openWindow(a):!1})),this.reset(),this},setLoading:function(){this.$more.text("游戏加载中..")},setLoaded:function(){},reset:function(a){return b.extend(this.dfParam,a||{}),this.dfParam.pn=0,this.cnf.totalCount=-1,this.$list.empty(),this.initPager(),this},initPager:function(){var a=this.cnf,b=this.dfParam,c=this,d=0;this.pageLoader=window.EnterScreen({selector:this.$more,fixTop:20,callback:function(){c.data().done(function(b){c.initDataFromLoadedList(),b&&b.games.length<=0?c.$more.addClass("hide"):(d+=b.games.length,console.log("总数:"+d),d<a.totalCount?setTimeout(function(){c.pageLoader.restart()},1e3):c.$more.addClass("hide"))}),b.pn++}})},data:function(a){var d=this.cnf,e=this;this.ajax.abort&&this.ajax.abort(),this.loadedList=[],e.setLoading();var g=b.extend({},this.dfParam,a);return this.ajax=b.getJSON(f,g,function(a){console.log(a),e.loadedList=c.value(a,"games")||[],d.totalCount<=0&&(d.totalCount=a.totalCount)}).always(function(a){e.setLoaded(),(!a||a.totalCount<=0)&&e.$more.text("暂时没有数据哦~")}),this.ajax},initDataFromLoadedList:function(){if(!(this.cnf.totalCount<=0)){var a=this.loadedList;a.length>0&&this.appendList(a),this.loadedList.length<=0}},appendList:function(a){for(var d,e=this.cnf.tmp,f=0,g=a.length;g>f;f++){var h=a[f];h.tip=h.tip||0,h.tipTitle=["","新","热","荐"][h.tip],h=c.format(e,h,"&nbsp;"),d=b(h),this.$list.append(d),function(a,b){setTimeout(function(){b.removeAttr("animate")},80*a)}(f,d)}}},module.exports=a});